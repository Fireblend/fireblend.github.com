
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />

<style id="webmakerstyle">
body {
  background: black;
  text-align: center;
  color: white;
}
canvas {
  border: 1px solid white;
}
a {
  color:#a4c2f4;
}
</style>
</head>
<body>
<canvas width="600" height="600"></canvas>
<div style="text-align: left">
<h2>Unnamed 17kb challenge game</h2>
This is a simple Javascript game developed using the <a href="https://straker.github.io/kontra/">Kontra micro-library</a>, intended to be under 17kb when zipped.

The game is a tribute to asymmetric 2-player games, such as <a href="http://www.spyparty.com/">Spy Party</a>.

<h2>Instructions</h2>
1 player plays as the <b>assassin</b> (keyboard) and another plays as the <b>sheriff</b> (mouse).<br><br>

The assassin's goal is to kill 3 villagers without being detected. In order to kill a villager, they must have talked to them for a total of 3 consecutive seconds (conversation will occur automatically when they are close to a villager), and then press the <i>space bar</i> key.
<br>Once killed, the screen will go dark for a short amount of time to allow them to escape the scene of the crime.

<br><br>

The sheriff's goal is to identify the assassin, and shoot them before they can accomplish their goal.

This game is a work in progress.
</div>
<script src="kontra.js"></script >
<script>
kontra.init();

let villagers = [];
let speechBubbles = [];

let blackFrames = -1;
let gameOver =false;
let deaths = 0;
var assassin = kontra.sprite({
  id:20,
  x: 100,
  y: 80,
  color_list: ['#fcad25', '#3c78d8', '#d170e5', '#f42e77'],
  color: '#bad455',//this.color_list[Math.floor(Math.random()*this.color_list.length)],
  width: 20,
  height: 20,
  dead: false,
  running: false,
  talking: 0,
  who: null,

  init: function(){
    this.color = this.color_list[Math.floor(Math.random()*this.color_list.length)];
    this.x = 300
    this.y = 300
  },

  update(){
    if(this.dead){
      this.dx = 0;
      this.dy = 0;
    }

    else if(target.shot && !this.running && !this.dead){
      this.running = true
      if(kontra.pointer.x <= this.x){
          this.dx = 2
      }
      else{
          this.dx = -2
      }
      if(kontra.pointer.y <= this.y){
          this.dy = 2
      }
      else{
          this.dy = -2
      }
    }
    else if(!this.running && !this.dead){
      if (this.x > kontra.canvas.width-this.width/2) {
        this.x = -this.width/2;
      }
      else if (this.x < -this.width/2) {
        this.x = kontra.canvas.width-this.width/2;
      }
      if (this.y < -this.width/2) {
        this.y = kontra.canvas.height-this.width/2;
      }
      else if (this.y > kontra.canvas.height-this.width/2) {
        this.y = -this.width/2;
      }

      if (kontra.keys.pressed('up')) {
        this.dy = -1;
      }
      else if  (kontra.keys.pressed('down')){
        this.dy = 1;
      } else {
        this.dy = 0;
      }

      if (kontra.keys.pressed('left')) {
        this.dx = -1;
      }
      else if  (kontra.keys.pressed('right')){
        this.dx = 1;
      } else {
        this.dx = 0;
      }

      if (kontra.keys.pressed('space')){
          delta = (new Date()).getTime() - this.talking
          if(speechBubbles[this.id].active && delta > 3000 && this.who != null){
              villagers[this.who].dead = true
              blackFrames = 120
              deaths = deaths+1
              this.who = null
          }
      }

      center_x = this.x-this.width/2
      center_y = this.y-this.width/2

      hide = true

      for (villager in villagers) {
        if(villagers[villager].id == this.id){
          continue
        }

        center_x2 = villagers[villager].x-villagers[villager].width/2
        center_y2 = villagers[villager].y-villagers[villager].width/2

        if(Math.abs(center_x-center_x2) < 30 && Math.abs(center_y-center_y2) < 30 ){
            if(speechBubbles[this.id].active==false){
              this.talking = (new Date()).getTime()
              this.who = villager
            }
            speechBubbles[this.id].active=true
            hide = false
            break
        }
      }
      if(hide){
        speechBubbles[this.id].active=false
        this.who = null
      }
    }
    this.advance()
  }
});

var target = kontra.sprite({
  x: 100,
  y: 80,
  color: '#bad455',//this.color_list[Math.floor(Math.random()*this.color_list.length)],
  width: 10,
  height: 10,
  shot: false,

  init: function(){
    this.x = 300
    this.y = 300
  },

  update: function() {
    if(!this.shot){
      this.x = kontra.pointer.x-this.width/2
      this.y = kontra.pointer.y-this.width/2
    }
  },

  onDown: function() {
    if(assassin.x < kontra.pointer.x &&
      assassin.x+assassin.width >kontra.pointer.x &&
      assassin.y < kontra.pointer.y &&
      assassin.y+assassin.height > kontra.pointer.y){
        assassin.color = "#ff0000"
        assassin.dead = true
    }
    this.shot = true
  }
});

kontra.pointer.track(target);

function createVillager(vid) {
  let villager = kontra.sprite({
    id: vid,
    x: 100,
    y: 80,
    color_list: ['#fcad25', '#3c78d8', '#d170e5', '#f42e77'],
    color: '#bad455',//this.color_list[Math.floor(Math.random()*this.color_list.length)],
    width: 20,
    height: 20,
    dx: 1,
    frames: -1,
    moves: [-1, 0, 0, 1],
    running: false,

    init: function(){
      this.color = this.color_list[Math.floor(Math.random()*this.color_list.length)];
      this.x = Math.floor(Math.random()*600)
      this.y = Math.floor(Math.random()*600)
    },

    update(){
      // wrap the sprites position when it reaches
      // the edge of the screen

      if(target.shot && !this.running){
        speechBubbles[vid].active = false
        this.running = true
        if(kontra.pointer.x <= this.x){
            this.dx = 2
        }
        else{
            this.dx = -2
        }
        if(kontra.pointer.y <= this.y){
            this.dy = 2
        }
        else{
            this.dy = -2
        }
      }

      else if(!this.running){
        if (this.x > kontra.canvas.width-this.width/2) {
          this.x = -this.width/2;
        }
        if (this.x < -this.width/2) {
          this.x = kontra.canvas.width-this.width/2;
        }
        if (this.y < -this.width/2) {
          this.y = kontra.canvas.height-this.width/2;
        }
        if (this.y > kontra.canvas.height-this.width/2) {
          this.y = -this.width/2;
        }
        if(this.frames == -1){
          this.rerollMove()
        }
        this.frames = this.frames-1;
        if(this.frames <= 0){
          this.rerollMove()
        }
      }
      this.advance()
    },

    rerollMove: function() {
        this.dx = this.moves[Math.floor(Math.random()*this.moves.length)];
        this.dy = this.moves[Math.floor(Math.random()*this.moves.length)];
        this.frames = 10+Math.floor(Math.random()*100);
    },

    checkSpeech: function(villager){
      if(villager.id == this.id || this.dead){
        return false
      }

      center_x = this.x-this.width/2
      center_y = this.y-this.width/2

      center_x2 = villager.x-villager.width/2
      center_y2 = villager.y-villager.width/2

      if(Math.abs(center_x-center_x2) < 30 && Math.abs(center_y-center_y2) < 30 ){
        if(speechBubbles[this.id].active == false){
        }
        speechBubbles[this.id].active=true
        this.moves = [-1, 0, 0, 0, 0, 1]
        return true
      }
    },

    isTalking: function() {
      for (villager in villagers) {
        hide = true
        if(this.checkSpeech(villagers[villager])){
          break
        }
        if(hide == true){
          speechBubbles[this.id].active=false
          this.moves = [-1, 0, 0, 1]
        }
      }
      this.checkSpeech(assassin)
    }
  });
  villager.init();
  villagers.push(villager);
}

function createSpeechBubble(villager) {
  let speechBubble = kontra.sprite({
    x: 100,
    y: 80,
    color: '#ffffff',//this.color_list[Math.floor(Math.random()*this.color_list.length)],
    width: 40,
    height: 20,
    active: false,

    update(){
      this.x = villager.x;
      this.y = villager.y-22;
    },

    render2(){
      if(this.active){
        this.render()
      }
    }

  });
  speechBubbles.push(speechBubble);
}

for (var i = 0; i < 20; i++) {
  createVillager(i);
  createSpeechBubble(villagers[i])
}
assassin.init();
createSpeechBubble(assassin)

function writeToScreen(text){
    kontra.context.save()
    kontra.context.strokeStyle = "#ffffff"
    kontra.context.font = 25 + 'px Courier New'
    kontra.context.textBaseline = 'middle'
    kontra.context.fillStyle = "#ffffff"
    kontra.context.fillText(text, 50, 50)
    kontra.context.restore()
}

var loop = kontra.gameLoop({  // create the main game loop
  update() {        // update the game state
    assassin.update();
    target.update();
    villagers.map(villager => {
      if(!villager.dead){
        villager.update();
      }
      villager.isTalking();
    })
    speechBubbles.map(speechBubble => {
      speechBubble.update();
    })
  },
  render() {        // render the game state
    if(blackFrames <= 0){
      villagers.map(villager => {
        if(!villager.dead){
          villager.render()
        }});
      speechBubbles.map(bubble => bubble.render2());
      assassin.render();
      target.render();
    } else {
      blackFrames = blackFrames-1
      writeToScreen("The assassin has struck!")
    }
    if(deaths == 3){
      writeToScreen("The assassin has won!")
    }
    if(target.shot){
      if(assassin.dead){
        writeToScreen("The assassin has been killed!")
      } else {
        writeToScreen("The assassin has escaped!")
      }
    }
  }
});

loop.start();    // start the game
//# sourceURL=userscript.js
</script>
</body>
</html>
